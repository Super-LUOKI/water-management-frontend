import{d as k,_ as v,s as m,o as b,c as C,a as _,b as t,u as g,i as E,w as i,e as w,E as L,f as F,g as S,r as x,t as D,h as T,j as R,k as M,l as z,m as B,p as N,n as O}from"./index-e9032b8d.js";import{H}from"./el-table-column-950bb16d.js";import{u as U,M as q}from"./region-eef4141d.js";import{s as P}from"./file-1faae522.js";/* empty css                        */function j(n,a,o,c){return H.get("/flow",{params:{region_id:n,page:a,page_count:o,device_code:c}})}const y=k("flow",{state:()=>({flowList:[],regionId:null,page:1,pageCount:10,deviceCode:null,total:0,selections:null}),actions:{async fetchFlowList(){const n=await j(this.regionId,this.page,this.pageCount,this.deviceCode);this.flowList=n.data,this.total=n.total}}});const A={class:"opt-warp"},Q={class:"left-opt"},Y={class:"right-opt"},G={__name:"DataOptions",setup(n){const a=y(),{deviceCode:o}=m(a),c=()=>{a.page=1,a.fetchFlowList()},u=()=>{P("流水信息",["用户名","门牌号","设备编码","结算流量(m³)","累计流量(m³)","上月使用(m³)","水表余额(元)","设备状态","操作时间"],a.selections).then(()=>{L.success("导出成功")})};return(r,d)=>{const f=F,l=S;return b(),C("div",A,[_("div",Q,[t(f,{modelValue:g(o),"onUpdate:modelValue":d[0]||(d[0]=e=>E(o)?o.value=e:null),placeholder:"设备编码"},null,8,["modelValue"]),t(l,{onClick:c},{default:i(()=>[w("查询")]),_:1})]),_("div",Y,[t(l,{type:"primary",plain:"",onClick:u},{default:i(()=>[w("导出")]),_:1})])])}}},J=v(G,[["__scopeId","data-v-ddccb4e0"]]);const K={class:"table-warp"},W={__name:"ContentTable",setup(n){const a=y(),{flowList:o}=m(a),c=x(!1),u=x(""),r=l=>{const e=new Date(Number(l));return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`},d=l=>{console.log(l),u.value=l.flow_chart_url,c.value=!0},f=l=>{a.selections=l.map(e=>[e.username,e.house_number,e.device_code,e.settle_flow,e.total_flow,e.last_month_flow,e.balance,e.status,r(e.created_at)])};return(l,e)=>{const s=T,h=S,$=R,I=M,V=z;return b(),C("div",K,[t($,{data:g(o),stripe:"",border:"","row-style":{height:"40px"},"cell-style":{padding:"5px"},style:{"font-size":"12px"},"show-overflow-tooltip":"",onSelectionChange:f},{default:i(()=>[t(s,{type:"selection",width:"50"}),t(s,{prop:"username",label:"用户名",width:"100"}),t(s,{prop:"house_number",label:"门牌号"}),t(s,{prop:"device_code",label:"设备编码"}),t(s,{prop:"settle_flow",label:"结算流量(m³)"}),t(s,{prop:"total_flow",label:"累计流量(m³)"}),t(s,{prop:"last_month_flow",label:"上月使用(m³)"}),t(s,{prop:"balance",label:"水表余额(元)"}),t(s,{prop:"status",label:"设备状态",width:"90"}),t(s,{prop:"created_at",label:"操作时间"},{default:i(({row:p})=>[_("span",null,D(r(p.created_at)),1)]),_:1}),t(s,{fixed:"right",label:"操作",width:"120"},{default:i(p=>[t(h,{link:"",type:"primary",size:"small",onClick:ce=>d(p.row)},{default:i(()=>[w("查看详情")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(V,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=p=>c.value=p),title:"流量曲线",width:"50%"},{footer:i(()=>[t(h,{onClick:e[0]||(e[0]=p=>c.value=!1)},{default:i(()=>[w("确定")]),_:1})]),default:i(()=>[t(I,{style:{width:"100%",height:"100%"},src:u.value,fit:"contain"},null,8,["src"])]),_:1},8,["modelValue"])])}}},X=v(W,[["__scopeId","data-v-9044631b"]]);const Z=n=>(N("data-v-e477df69"),n=n(),O(),n),ee={class:"flow-query content-warp"},te={class:"left"},oe=Z(()=>_("div",{class:"title"},"所有区域",-1)),ae={class:"right"},le={class:"content"},se={class:"pagination-warp"},ne={__name:"index",setup(n){const a=U();a.fetchAllRegions();const o=y();o.fetchFlowList();const{regionList:c}=m(a),{page:u,pageCount:r,total:d}=m(o),f=e=>{o.$reset(),o.regionId=e,o.fetchFlowList()},l=e=>{o.page=e,o.fetchFlowList()};return(e,s)=>{const h=B;return b(),C("div",ee,[_("div",te,[oe,t(q,{"data-list":g(c),onSelect:f},null,8,["data-list"])]),_("div",ae,[t(J),_("div",le,[t(X),_("div",se,[t(h,{"page-size":g(r),"pager-count":9,layout:"prev, pager, next",total:g(d),background:"",small:"",onCurrentChange:l},null,8,["page-size","total"])])])])])}}},ue=v(ne,[["__scopeId","data-v-e477df69"]]);export{ue as default};
